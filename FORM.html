<script>
    const form = document.getElementById('registroForm');
    const formMessage = document.getElementById('formMessage');

    form.addEventListener('submit', async function(e) {
        e.preventDefault(); // Impede o envio padrão do formulário

        formMessage.textContent = 'Enviando... Aguarde a resposta do servidor.';
        formMessage.className = 'message'; // Limpa classes de sucesso/erro

        const formData = new FormData(form);
        const data = {};
        for (const [key, value] of formData.entries()) {
            data[key] = value;
        }

        // Você PRECISARÁ COLOCAR A URL DO SEU GOOGLE APPS SCRIPT AQUI (copiada do Passo 2)
        const gasUrl = 'https://script.google.com/macros/s/AKfycbz3B9POSD64dBKmEP9p47eEsnv71mm4VaRB2CLC7OCdylEAUvJHBWBT0hmsTi7bGcEY/exec'; 

        try {
            const response = await fetch(gasUrl, {
                method: 'POST',
                // REMOVIDO: mode: 'no-cors'
                // Agora, o script Apps Script está tentando enviar cabeçalhos CORS,
                // então o navegador deve permitir ler a resposta diretamente.
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(data).toString()
            });

            // Tenta ler a resposta como JSON
            const result = await response.json(); 
            
            // Loga a resposta completa no console do navegador para depuração
            console.log('--- Resposta COMPLETA do Apps Script ---', result); 

            if (result.status === 'success') {
                formMessage.textContent = '✅ Sucesso! ' + result.message;
                formMessage.className = 'message success';
                form.reset(); // Limpa o formulário após o envio
            } else {
                formMessage.textContent = '❌ ERRO: ' + result.message;
                formMessage.className = 'message error';
                // Imprime detalhes adicionais no console do navegador
                console.error('Dados que o Apps Script RECEBEU:', result.received);
                console.error('Linha que o Apps Script TENTOU ADICIONAR:', result.rowToAppend);
                if (result.stack) {
                    console.error('Rastreamento de pilha do erro (Stack Trace):', result.stack);
                }
            }
        } catch (error) {
            console.error('Erro de rede ou ao processar a resposta do formulário:', error);
            formMessage.textContent = '❌ Ocorreu um erro de comunicação ou processamento no navegador. Verifique o console para detalhes.';
            formMessage.className = 'message error';
        }
    });
</script>
